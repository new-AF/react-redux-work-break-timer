<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>
		
	</title>
	<script src="./libraries/babel.min.js"></script>
	<script src="./libraries/react.development.js"></script>
	<script src="./libraries/react-dom.development.js"></script>
	
	<script src="./libraries/react.production.min.js"></script>
	<script src="./libraries/react-dom.production.min.js"></script>
	
	<!-- redux https://unpkg.com/redux@4.2.0/dist/redux.js -->
	<script src="./libraries/redux.js"></script>
	
	<!-- react-redux https://cdnjs.cloudflare.com/ajax/libs/react-redux/8.0.5/react-redux.js -->
	<script src="./libraries/react-redux.js"></script>
	
	<!-- font awesome icons -->
	<link href='./libraries/css/all.css' rel='stylesheet'>
	
	<style>
		body{
			margin: 0;
		}
		*{
			outline:1px solid black;
			font-family: "Consolas","Lucida Console", monospace, "Tahoma", sans-serif;
			color: black
		}
	</style>
</head>
  
<body>
	<main>
		<div id="react-container-1" class="react-container">
		
		<div>
	</main>
	
	<script type="text/babel">

		//----------------------- global objects ----------------------//
		const newDate= (h=0,totalMinutes=0,s=0)=>{
			
			const obj=new Date(0);
			
			obj.setHours(h, totalMinutes, s);
			return obj;
		};
		
		//totalMinutes can be >=60
		const convertTotalMinutes=(totalMinutes,asString=false)=>{
			const hours=	Math.floor(totalMinutes/60);
			
			//minutes are in range [0-59]
			const minutes=	totalMinutes%60;
			
			
			if(asString){
				const [h,m,s]= [`${hours<10 ? '0' : ''}${hours}`,
				`${minutes<10 ? '0' : ''}${minutes}`,
				'00', ];
				
				return {
					hours:	h,
					minutes:m,
					seconds:s
				};
			}
			else
				return {
				hours:	hours,
				minutes:minutes,
				seconds:0
			};
		};
		
		//
		const formatTotalMinutes= totalMinutes=>{
			const {hours,minutes}= convertTotalMinutes(totalMinutes);
			
			return hours>=1 ? `${hours} hour(s), ${minutes} minute(s)` : `${minutes} minute(s)`;
		};
		const padtime=int=>	`${int<10?'0':''}${int}`;
		//----------------------- break state ----------------------//
		const breakSliderState0={
			/*total minutes; can be >=60*/
			minutes:		'',/*integer*/

			min:			1,
			max:			60,/*10hours*/
			defaultMinutes:	5/*5*/
		};
		//----------------------- work state ----------------------//
		const workSliderState0={
			/*total minutes; can be >=60*/
			minutes:		'',/*integer*/

			min:			1,
			max:			60,
			defaultMinutes:	25/*25*/
		};
		//----------------------- timer state ----------------------//
		const timerState0={
			audio:			'',
		
			dateObj:		newDate(),
			
			formatter:		new Intl.DateTimeFormat('en-US',{'hour12':false, 'minute':'2-digit', 'second':'2-digit'}),
			
			/*when timer is 00:00:00*/
			time0:			newDate().getTime(),
			
			//is timer in work or break mode?
			'switch-to-break':false,

			'work-title':	'Session',
			'break-title':	'Break',
			
			'work-total-minutes':	'',/**integer/
			'break-total-minutes':	'',/**integer/
			
			setTimeoutId:	'',/*integer*/
			playing:		'',/*true or false*/
	
			'play-icon':	'fa-solid fa-play',
			'pause-icon':	'fa-solid fa-pause',
			'button-icon':	'',/*string*/

		};
		timerState0['button-icon']=timerState0['play-icon']
		//----------------------- break reducer ----------------------//
		const breakReducer=(state={...breakSliderState0}, action)=>{
			const newState={...state};
			const {minutes,type}=action;
			
			/*SET ONCE*/
			if(type==='break-range-set-minutes-once'){
				newState['minutes']=minutes;
			}
			/*range EVENT*/
			else if(type==='break-range-onchange-minutes'){
				newState['minutes']=minutes;
			}
			else if(action.typeBreak==='on-reset'){
				newState['minutes']=newState.defaultMinutes;
			}
			return newState;
		}
		//----------------------- work reducer ----------------------//
		const workReducer=(state={...workSliderState0}, action)=>{
			const newState={...state};
			const {type,minutes}=action;
			
			/*SET ONCE*/
			if(type==='work-range-set-minutes-once'){
				newState['minutes']=minutes;
			}
			/*range EVENT*/
			else if(type==='work-range-onchange-minutes'){
				newState['minutes']=minutes;
			}
			else if(action.typeWork==='on-reset'){
				newState['minutes']=newState.defaultMinutes;
			}

			return newState;
		}
		//----------------------- timer reducer ----------------------//
		const timerReducer=(state={...timerState0},action)=>{

			const newState={...state,'time-text':''};
			const {type,func,ms}=action;
	
			const {'dateObj':date, playing, setTimeoutId, time0, formatter, audio}=newState;
			
			//when app starts
			//		set 'work-total-minutes'
			//		and set date object 'dateObj'
			//beacuse Session minutes are first
			if(type==='work-total-minutes-set-once'){
				const {totalMinutes}= action;
				newState['work-total-minutes']=totalMinutes;
				date.setHours(0,totalMinutes);
				
			
			}
			//when app starts set 'break-total-minutes'
			else if(type==='break-total-minutes-set-once'){
				const {totalMinutes}= action;
				newState['break-total-minutes']=totalMinutes;

			}
			//when work slider changes 
			//		set 'work-total-minutes'
			//		and set date if mode is corret
			else if(type==='work-total-minutes-set-event'){
				const {totalMinutes}= action;
				newState['work-total-minutes']=totalMinutes;
				//if timer is initial or paused [should be hidden with opacity and z-index]
				//and it is currently work
				//then set 'dateObj'
				if((playing===false || playing==='') && newState['switch-to-break']===false){
				
					date.setHours(0,totalMinutes,0);
				}
			}
			//when work slider changes 
			//		set 'break-total-minutes'
			//		and set date if mode is corret
			else if(type==='break-total-minutes-set-event'){
				const {totalMinutes}= action;
				newState['break-total-minutes']=totalMinutes;
				
				if(playing===false && newState['switch-to-break']===true){
				
					date.setHours(0,totalMinutes,0);
				}
				
			}
			//when play pause button is clicked
			else if(type==='play-pause'){
				//console.log('play-pause');
				
				//if first time, initialize 'playing', call 'setInterval' set icon
				if(playing===''){
					newState['playing']=true;
					newState['setTimeoutId']=setInterval(func,ms);
					newState['button-icon']=newState['pause-icon'];
				}
				//pause;
				else if(playing===true){
					newState['playing']=false;
					clearInterval(setTimeoutId);
					newState['setTimeoutId']='';
					newState['button-icon']=newState['play-icon'];
					
				}
				//start again
				else{
					newState['playing']=true;
					newState['setTimeoutId']=setInterval(func,ms);
					newState['button-icon']=newState['pause-icon'];
				}

			}
			//subtract 1 second
			else if(type==='date-decrement'){
				//timer ended; play beep sound
				if(date.getTime()===time0){
					/*switch from Session <-> Break*/
					newState['switch-to-break']= !newState['switch-to-break'];
					
					date.setHours(0,
					newState['switch-to-break'] ? newState['break-total-minutes'] : newState['work-total-minutes'],
					0);
					
					newState['audio'].play();
					
					
				}

				//decrement seconds	
				const s= date.getSeconds()-1;
				date.setSeconds(s);				
	

				//console.log('date-decrement');
				
			}
			else if(type==='set-audio-once'){
				newState['audio']=action.audio;
			}
			//when stop is clicked
			//		stop countdown
			//		rewind audio
			//		set default values to break & work sliders
			else if(type==='on-reset'){
				if(setTimeoutId !== ''){
					clearInterval(setTimeoutId);
					newState['setTimeoutId']='';
				}
				audio.currentTime= 0;
			}
			
			return newState;
		};
		//----------------------- map state to props ----------------------//
		const mapStateToProps= state=>state;

		//----------------------- map dispatch to props ----------------------//
		const mapDispatchToProps= dispatchFunction=>({
			
			/*--ONCE range 1 & 2 set minutes--*/
			'do-break-range-set-minutes-once':minutes=>dispatchFunction({
				type:'break-range-set-minutes-once',
				minutes:minutes
			}),
			
			'do-work-range-set-minutes-once':minutes=>dispatchFunction({
				type:'work-range-set-minutes-once',
				minutes:minutes
			}),
			
			
			/*--EVENT; range 1 & 2 onChange; set minutes--*/
			'do-break-range-onchange-minutes-event':event=>dispatchFunction({
				type:'break-range-onchange-minutes',
				minutes:event.target.valueAsNumber
			}),
			
			'do-work-range-onchange-minutes-event':event=>dispatchFunction({
				type:'work-range-onchange-minutes',
				minutes:event.target.valueAsNumber
			}),
			
			'do-play-pause':(event,func,ms)=>dispatchFunction({
				type:'play-pause',
				func:func,
				ms:ms
			}),
			
			'do-date-decrement':()=>dispatchFunction({
				type:'date-decrement'
			}),
			
			'do-set-setTimeoutId':(func,ms)=>dispatchFunction({
				type:'set-setTimeoutId',
				func:func,
				ms:ms
			}),
			
			'do-work-total-minutes-set-once':totalMinutes=>dispatchFunction({
				type:'work-total-minutes-set-once',
				totalMinutes:totalMinutes
			}),
			
						
			'do-break-total-minutes-set-once':totalMinutes=>dispatchFunction({
				type:'break-total-minutes-set-once',
				totalMinutes:totalMinutes
			}),
			
			'do-work-total-minutes-set-event':event=>dispatchFunction({
				type:'work-total-minutes-set-event',
				totalMinutes:event.target.valueAsNumber
			}),
			
						
			'do-break-total-minutes-set-event':event=>dispatchFunction({
				type:'break-total-minutes-set-event',
				totalMinutes:event.target.valueAsNumber
			}),
			
			
			//set audio DOM object reference; when page loads starts
			'do-set-audio-once':domObject=>dispatchFunction({
				type:'set-audio-once',
				audio:domObject
			}),
			
			//when stop button is clicked
			'do-on-reset':event=>dispatchFunction({
				type:'on-reset',
				typeWork:'on-reset',
				typeBreak:'on-reset'
			})

		});
		
		//----------------------- react component Provider ----------------------//
		const Provider = ReactRedux.Provider;
		//----------------------- connect function ----------------------//
		const connect= ReactRedux.connect;
		//----------------------- store i.e. STATE object ----------------------//
		const store= Redux.createStore(Redux.combineReducers({
			breakState:		breakReducer,
			workState:		workReducer,
			timerState:		timerReducer
		}));
		//----------------------- component Button ----------------------//
		const Button=props=>{
			const {text,onClick,onMouseDown,sentStyle,id,className}=props;
			const style={
				padding:'0 0.8rem',
				'font-size':'2rem',
				'cursor':'pointer',
				...sentStyle
			};
			return <button id={id} className={className} style={style} onClick={onClick} onMouseDown={onMouseDown}>
				{text}
			</button>;
		};
		//----------------------- component Range ----------------------//
		const Range= props=>{
			const {sentStyle,min,max,value,onChange}=props;
			
			const style={
				cursor:'pointer',
				...sentStyle
			};
			return <input style={style} type='range' min={min} max={max} onInput={onChange} value={value}/>;
		};
		//----------------------- component Slider ----------------------//
		const Slider=props=>{
	
			const {sentStyle,min,max,minutes,defaultMinutes,onChange,plusId,minusId,valueId,formatTotalMinutes}=props;
			
			const text= formatTotalMinutes(minutes);
			
			const style={
				'display':'grid',
				'grid-gap':'0.5rem',
				border:'0.2rem solid black',
				'border-radius':'0.25rem',
				'padding':'0.5rem',
				...sentStyle
			};
			
			/*HIDDEN; FOR Testing purposes; value must an element by itself */
			const valueStyle={
				/*'color':'transparent',*/
				'grid-column':'1',
				'grid-row':'1',
				'text-align':'center'
			};
			
			/*SHOWN;*/
			const afterValueStyle={
				'grid-column':'2/4',
				'grid-row':'1',
				'text-align':'center'
			};
	
			const rangeStyle={
				'cursor':'pointer',
			};
			const buttonStyle={
				
			};
			
			/*simulate triggering event*/
			const b1= e=>onChange({target:{valueAsNumber: minutes>min && minutes<=max ? minutes-1 : minutes }});
			const b2= e=>onChange({target:{valueAsNumber: minutes>=min && minutes<max ? minutes+1 : minutes }});
			
			return <div style={style}>
				<div id={valueId} style={valueStyle}>
					{minutes}
				</div>
				
				<div style={afterValueStyle}>
					{text}
				</div>

				<Button id={plusId} sentStyle={buttonStyle} text={'-'} onClick={b1}/>
				
				<Range value={minutes} min={min} max={max} onChange={onChange}/>
				
				<Button id={minusId} sentStyle={buttonStyle} text={'+'} onClick={b2}/>
			</div>;
		};

		//----------------------- component SessionLength ----------------------//
		const SessionLength=props=>{
			const {hideZindex,hideOpacity,sentStyle,text,slider,innerId,plusId,minusId,timeValueId,formatTotalMinutes}=props;
			const {min,max,minutes,defaultMinutes,onChange}=slider;
			const style={
				display:'grid',
				'grid-template-columns':'auto',
				'grid-template-rows':'auto auto',
				transition:'opacity 500ms',
				opacity:hideOpacity,
				...sentStyle
			};
			const disableStyle={
				'grid-column':'1',
				'grid-row':'1/3',
				
				'background-color':'transparent',
				'z-index':hideZindex
			};
			const textStyle={
				'grid-column':'1',
				'grid-row':'1',
				'text-align':'center',
				'font-weight':'bold',
				'font-size':'1.5rem',
				'margin-bottom':'1rem'
			};
			const sliderStyle={
				'grid-column':'1',
				'grid-row':'2',
			}
			return <div style={style}>
				<div style={disableStyle}></div>
				
				<div style={textStyle} id={innerId}>{text}</div>
				
				<Slider sentStyle={sliderStyle} min={min} max={max} onChange={onChange} minutes={minutes} defaultMinutes={defaultMinutes} plusId={plusId} minusId={minusId} valueId={timeValueId} formatTotalMinutes={formatTotalMinutes}/>
				
			</div>;
		};
		//----------------------- component Timer ----------------------//
		const Timer=props=>{
			const {title,audioId,date,mm,ss,convertTotalMinutes,onPlayPause,onReset,sentStyle,startPauseId,resetId,titleId,timeId,playPauseOnClick,buttonIcon,arrowRow}=props;

			
			const style={
				display:'grid',
				'grid-gap':'0.5rem',
				'padding':'0.5rem',
				'grid-template-columns':'auto auto auto auto',
				'grid-template-rows':'repeat(3,auto)',
				border:'0.2rem solid black',
				'border-radius':'0.25rem',
				...sentStyle
			};
			
			/*minutes [0-59] value;*/
			const timeStyle={
				'grid-column':'2/5',
				'grid-row':'1/3',
				'font-size':'3rem',
				'text-align':'center',
				'display':'grid',
				'grid-template-columns':'auto auto',
				'justify-content':'center',
				'grid-gap':'1rem'
			};
			

			
			const buttonStyle={
				'font-size':'1rem',
				padding:'0.5rem 0.8rem',
				'cursor':'pointer'
			};

			const playPauseStyle={
				'grid-column':'2/4',
				'grid-row':'3'
			};

			const resetStyle={
				'grid-column':'4',
				'grid-row':'3'
			};

			const dateStyle={
				'grid-column':'2/4',
				'grid-row':'4',
				'text-align':'center'
			};

			const common1= {
					'font-size':'1rem',
					'font-weight':'bold'
				};

			return <div style={style}>
			
				<div style={timeStyle}>
				
					<div id={titleId}>{title}</div>
					<div id={timeId}>{mm}:{ss}</div>

					{/*------------ Session/Break + Arrow ------------*/}
					<div style={{
						'display':'grid',
						'grid-template-columns':'repeat(2,auto)',
						'grid-template-rows':'repeat(2,auto)',
						'grid-column':'2',
						'grid-row':'1',
						'grid-gap':'0.5rem',
						'justify-items':'end',
						'align-items':'center',
						'transition':'grid-row 500ms',
						...common1
					}}>
					
					{/*---- "Session" ----*/}
						<div style={{
							'grid-column':'1',
							'grid-row':'1',
							...common1
						}}>Session</div>
					{/*---- "Break" ----*/}
						<div style={{
							'grid-column':'1',
							'grid-row':'2',
							...common1
						}}>Break
						</div>
					{/*---- Arrow----*/}
						<i style={{
							'grid-column':'2',
							'grid-row':`${arrowRow}`,
							...common1
							
						}} class="fa-solid fa-arrow-left"></i>
						
					</div>
					{/*------------  end of box ------------*/}
				</div>
				
				
				
				
				<div style={dateStyle}>
					{`${date}`}
				</div>
				
				
				
				<Button id={startPauseId} onClick={onPlayPause} sentStyle={{...buttonStyle,...playPauseStyle}} className={buttonIcon} />
				
				<Button id={resetId} onClick={onReset} sentStyle={{...buttonStyle,...resetStyle}} className="fa-solid fa-stop"/>
				
				<audio id={audioId} src="beep.ogg"/>

			</div>;
		};

		//----------------------- component App WITHOUT LOCAL STATE ----------------------//
		class App extends React.Component{
			constructor(props){
				super(props);
			}

			render(){
				const style= {
					'display':'grid',
					'grid-template-columns':'0.5fr repeat(2, auto) 0.5fr',
					'grid-template-rows':'0.5fr repeat(2, auto) 0.5fr',
					'grid-gap':'2rem',
					/**/
					'align-items':'center',
					'justify-items':'center',
					/**/
					'background-color': 'wheat',
					'min-height': '100vh',
				};
				const headerStyle={
					'font-weight':'bold',
					'grid-column':'2/4',
					'grid-row':'1'
				};
				const footerStyle={
					'font-weight':'bold',
					'grid-column':'2/4',
					'grid-row':'4'
				};

				const props=this.props;
				
				const {breakState,workState,timerState}=props;
				const {'dateObj':date,playing}=timerState;
				const [hh,mm,ss]=[date.getHours(), date.getMinutes(), date.getSeconds()]
				
				/* break state */
				const breakObject={
					onChange:		event=>{
										props['do-break-range-onchange-minutes-event'](event),
										props['do-break-total-minutes-set-event'](event)
									},
					...breakState
				};
				
				/* work state */
				const workObject={
					onChange:		event=>{
										props['do-work-range-onchange-minutes-event'](event),
										props['do-work-total-minutes-set-event'](event)
									},
					...workState
				};
				const timerStyle={
					'grid-column':'2/4',
					'grid-row':'2',
					'justify-self':'stretch'
				};
				const workSliderStyle={
					'grid-column':'2',
					'grid-row':'3',	
					'justify-self':'stretch'
				};	
				const breakSliderStyle={
					'grid-column':'3',
					'grid-row':'3',
					'justify-self':'stretch'
				};

				
				return (
				<div style={style}>
					
					<h1 style={headerStyle}>React Redux Work/Break Timer</h1>

					<SessionLength
					text="Session Length"
					plusId="break-decrement"
					minusId="session-decrement"
					innerId="session-label"
					slider={workObject}
					timeValueId="session-length"
					sentStyle={workSliderStyle}
					formatTotalMinutes={formatTotalMinutes}
					hideOpacity={playing===false || playing==='' ? '1' : '0'}
					hideZindex={playing===false || playing==='' ? '-1' : '99'}
					/>
					
					<SessionLength
					text="Break Length"
					plusId="break-increment"
					minusId="session-increment"
					innerId="break-label"
					slider={breakObject}
					timeValueId="break-length"
					sentStyle={breakSliderStyle}
					formatTotalMinutes={formatTotalMinutes}
					hideOpacity={playing===false || playing==='' ? '1' : '0'}
					hideZindex={playing===false || playing==='' ? '-1' : '99'}
					/>

					<Timer
					mm={hh>0 ? padtime(hh*60) : padtime(mm)}
					ss={padtime(ss)}
					date={date}
					audioId='beep'
					totalMinutes={timerState.totalMinutes}
					convertTotalMinutes={convertTotalMinutes}
					onPlayPause={e=>{					
							props['do-play-pause'](e,props['do-date-decrement'],1000);
						}
					}
					onReset={props['do-on-reset']}
					buttonIcon={timerState['button-icon']}
					sentStyle={timerStyle}
					/*required id s to pass tests;*/
					startPauseId="start_stop"
					resetId="reset"
					titleId="timer-label"	/*hide; show 'Session' or 'Break';*/
					timeId="time-left"		/*show e.g. 60:00 then 59:59*/
					
					
					arrowRow={timerState['switch-to-break'] ? 2 : 1}
					
					title={timerState['switch-to-break']===false ? timerState['work-title'] :
						timerState['break-title']}
					/>
					
					<footer style={footerStyle}><p>by Abdullah Fatota</p></footer>
				</div>);
			}
			componentDidMount(){
				const {props}=this;
				props['do-break-range-set-minutes-once'](props.breakState.defaultMinutes);
				props['do-work-range-set-minutes-once'](props.workState.defaultMinutes);
				
				props['do-break-total-minutes-set-once'](props.breakState.defaultMinutes);
				props['do-work-total-minutes-set-once'](props.workState.defaultMinutes);
				
				props['do-set-audio-once'](document.querySelector('#beep'));

			}
		}
		//----------------------- APP2 component ----------------------//
		const App2= connect(mapStateToProps, mapDispatchToProps)(App);
		
		//----------------------- react componentAppWrapper ----------------------//
		class AppWrapper extends React.Component{
			constructor(props){
				super(props);		
			}
			render(){
				//store prop IS REQUIRED.
				return (<Provider store={store}>
					<App2/>
				</Provider>);
			}
		}
		//----------------------- put component AppWrapper in DOM ----------------------//

		const container=document.querySelector('#react-container-1');
		ReactDOM.render(<AppWrapper/>,container);
		

	</script>

	<!-- free code camp test suite -->
	<script src="./libraries/test bundle.js"></script>

	
</body>

</html>