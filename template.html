<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>
		
	</title>
	<script src="./libraries/babel.min.js"></script>
	<script src="./libraries/react.development.js"></script>
	<script src="./libraries/react-dom.development.js"></script>
	
	<!-- redux https://unpkg.com/redux@4.2.0/dist/redux.js -->
	<script src="./libraries/redux.js"></script>
	
	<!-- react-redux https://cdnjs.cloudflare.com/ajax/libs/react-redux/8.0.5/react-redux.js -->
	<script src="./libraries/react-redux.js"></script>
	
	<!-- font awesome icons -->
	<link href='./libraries/css/all.css' rel='stylesheet'>
	
	<style>
		body{
			margin: 0;
		}
		*{
			outline:1px solid black;
			font-family: "Consolas","Lucida Console", monospace, "Tahoma", sans-serif;
			color: black
		}
	</style>
</head>
  
<body>
	<main>
		<div id="react-container-1" class="react-container">
		
		<div>
	</main>
	
	<script type="text/babel">

		//----------------------- global objects ----------------------//
		const newDate= (totalMinutes=0)=>{
			
			const obj=new Date(0);
			
			obj.setMinutes(totalMinutes);
			return obj;
		};
		
		//totalMinutes can be >=60
		const convertTotalMinutes=(totalMinutes,asString=false)=>{
			const hours=	Math.floor(totalMinutes/60);
			
			//minutes are in range [0-59]
			const minutes=	totalMinutes%60;
			
			
			if(asString){
				const [h,m,s]= [`${hours<10 ? '0' : ''}${hours}`,
				`${minutes<10 ? '0' : ''}${minutes}`,
				'00', ];
				
				return {
					hours:	h,
					minutes:m,
					seconds:s
				};
			}
			else
				return {
				hours:	hours,
				minutes:minutes,
				seconds:0
			};
		};
		
		//
		const formatTotalMinutes= totalMinutes=>{
			const {hours,minutes}= convertTotalMinutes(totalMinutes);
			
			return hours>=1 ? `${hours} hour(s), ${minutes} minute(s)` : `${minutes} minute(s)`;
		};
		//----------------------- state0 Slider reducer ----------------------//
		const breakSliderState0={
			/*total minutes; can be >=60*/
			minutes:		'',

			min:			1,
			max:			720,/*10hours*/
			defaultMinutes:	5
		};
		const workSliderState0={
			/*total minutes; can be >=60*/
			minutes:		'',

			min:			1,
			max:			60,
			defaultMinutes:	25
		};
		const timerState0={
			mode:			'session'/*i.e. 'session' or 'break'*/,
			setTimeoutId:	'',
			paused:			false,
			'date-obj':		newDate()
		};
		//----------------------- Slider reducer ----------------------//
		const breakReducer=(state={...breakSliderState0}, action)=>{
			const newState={...state};
			const {minutes,type}=action;
			
			/*SET ONCE*/
			if(type==='break-range-set-minutes-once'){
				newState['minutes']=minutes;
			}
			/*range EVENT*/
			else if(type==='break-range-onchange-minutes'){
				newState['minutes']=minutes;
			}
			return newState;
		}
		const workReducer=(state={...workSliderState0}, action)=>{
			const newState={...state};
			const {type,minutes}=action;
			
			/*SET ONCE*/
			if(type==='work-range-set-minutes-once'){
				newState['minutes']=minutes;
			}
			/*range EVENT*/
			else if(type==='work-range-onchange-minutes'){
				newState['minutes']=minutes;
			}
			return newState;
		}
		const timerReducer=(state={...timerState0},action)=>{

			const newState={...state};
			const {type}=action;
	
			const {'date-obj':date, paused}=newState;
			
			
			if(type==='play-pause' && paused===false){
				//console.log('play-pause');
	

			}
			else if(type==='set-date-obj-event'){
				const {totalMinutes}= action;
				/*reset first*/
				date.setHours(0);
				
				date.setMinutes(totalMinutes);
			}
			else if(type==='set-date-obj-decrement'){
				const s= date.getSeconds()-1;
				date.setSeconds(s);
				console.log('set-date-obj-decrement');
			}
			else if(type==='set-setTimeoutId'){
				
				const {func,ms}=action;
				const {setTimeoutId:id0}=newState;
				//console.log(newState,action);
				if(id0!==''){
					clearInterval(id0);
				}
				newState['setTimeoutId']=setInterval(func,ms);

			}
			
			return newState;
		};
		//----------------------- map state to props ----------------------//
		const mapStateToProps= state=>state;

		//----------------------- map dispatch to props ----------------------//
		const mapDispatchToProps= dispatchFunction=>({
			
			/*--ONCE range 1 & 2 set minutes--*/
			'do-break-range-set-minutes-once':minutes=>dispatchFunction({
				type:'break-range-set-minutes-once',
				minutes:minutes
			}),
			
			'do-work-range-set-minutes-once':minutes=>dispatchFunction({
				type:'work-range-set-minutes-once',
				minutes:minutes
			}),
			
			
			/*--EVENT; range 1 & 2 onChange; set minutes--*/
			'do-break-range-onchange-minutes-event':event=>dispatchFunction({
				type:'break-range-onchange-minutes',
				minutes:event.target.valueAsNumber
			}),
			
			'do-work-range-onchange-minutes-event':event=>dispatchFunction({
				type:'work-range-onchange-minutes',
				minutes:event.target.valueAsNumber
			}),
			
			'do-play-pause':event=>dispatchFunction({
				type:'play-pause'
			}),
			
			'do-set-obj-event':event=>dispatchFunction({
				type:'set-date-obj-event',
				totalMinutes:event.target.valueAsNumber
			}),
			
			'do-set-obj-decrement':()=>dispatchFunction({
				type:'set-date-obj-decrement'
			}),
			
			'do-set-setTimeoutId':(func,ms)=>dispatchFunction({
				type:'set-setTimeoutId',
				func:func,
				ms:ms
			})
			

		});
		
		//----------------------- react component Provider ----------------------//
		const Provider = ReactRedux.Provider;
		//----------------------- connect function ----------------------//
		const connect= ReactRedux.connect;
		//----------------------- store i.e. STATE object ----------------------//
		const store= Redux.createStore(Redux.combineReducers({
			breakState:		breakReducer,
			workState:		workReducer,
			timerState:		timerReducer
		}));
		//----------------------- component Button ----------------------//
		const Button=props=>{
			const {text,onClick,onMouseDown,sentStyle,id,className}=props;
			const style={
				padding:'0 0.8rem',
				'font-size':'2rem',
				'cursor':'pointer',
				...sentStyle
			};
			return <button id={id} className={className} style={style} onClick={onClick} onMouseDown={onMouseDown}>
				{text}
			</button>;
		};
		//----------------------- component Range ----------------------//
		const Range= props=>{
			const {sentStyle,min,max,value,onChange}=props;
			
			const style={
				...sentStyle
			};
			return <input style={style} type='range' min={min} max={max} onInput={onChange} value={value}/>;
		};
		//----------------------- component Slider ----------------------//
		const Slider=props=>{
	
			const {min,max,minutes,defaultMinutes,onChange,plusId,minusId,valueId,formatTotalMinutes}=props;
			
			const text= formatTotalMinutes(minutes);
			
			const style={
				'display':'grid',
				'grid-gap':'0.5rem',
				border:'0.2rem solid black',
				'border-radius':'0.25rem',
				'padding':'0.5rem'
			};
			
			/*HIDDEN; FOR Testing purposes; value must an element by itself */
			const valueStyle={
				/*'color':'transparent',*/
				'grid-column':'1',
				'grid-row':'1',
				'text-align':'center'
			};
			
			/*SHOWN;*/
			const afterValueStyle={
				'grid-column':'2/4',
				'grid-row':'1',
				'text-align':'center'
			};
	
			const rangeStyle={
				'cursor':'pointer',
			};
			const buttonStyle={
				
			};
			
			/*simulate triggering event*/
			const b1= e=>onChange({target:{valueAsNumber: minutes>min && minutes<=max ? minutes-1 : minutes }});
			const b2= e=>onChange({target:{valueAsNumber: minutes>=min && minutes<max ? minutes+1 : minutes }});
			
			return <div style={style}>
				<div id={valueId} style={valueStyle}>
					{minutes}
				</div>
				
				<div style={afterValueStyle}>
					{text}
				</div>

				<Button id={plusId} sentStyle={buttonStyle} text={'-'} onClick={b1}/>
				
				<Range value={minutes} min={min} max={max} onChange={onChange}/>
				
				<Button id={minusId} sentStyle={buttonStyle} text={'+'} onClick={b2}/>
			</div>;
		};

		//----------------------- component SessionLength ----------------------//
		const SessionLength=props=>{
			const {text,slider,innerId,plusId,minusId,timeValueId,formatTotalMinutes}=props;
			const {min,max,minutes,defaultMinutes,onChange}=slider;
			const style={
			
			};
			const textStyle={
				'text-align':'center',
				'font-weight':'bold',
				'font-size':'1.5rem',
				'margin-bottom':'1rem'
			};

			return <div style={style}>
				<div style={textStyle} id={innerId}>{text}</div>
				
				<Slider min={min} max={max} onChange={onChange} minutes={minutes} defaultMinutes={defaultMinutes} plusId={plusId} minusId={minusId} valueId={timeValueId} formatTotalMinutes={formatTotalMinutes}/>
			</div>;
		};
		//----------------------- component Timer ----------------------//
		const Timer=props=>{
			//value; is Date object
			const {date,totalMinutes,convertTotalMinutes,onPlayPause,mode,sentStyle,startPauseId,resetId,titleId,timeId,playPauseOnClick,paused}=props;
			
			//const {hours,minutes,seconds}=convertTotalMinutes(totalMinutes,true);
			const [hours,minutes,seconds]=[date.getHours(), date.getMinutes(), date.getSeconds()];
			const [hh,mm,ss]= [`${hours<10 ? '0' : ''}${hours}`,
				`${minutes<10 ? '0' : ''}${minutes}`,
				`${seconds<10 ? '0' : ''}${seconds}`, ];
			
			const style={
				display:'grid',
				'grid-gap':'0.5rem',
				'padding':'0.5rem',
				'grid-template-columns':'repeat(4,1fr)',
				'grid-template-rows':'repeat(3,auto)',
				border:'0.2rem solid black',
				'border-radius':'0.25rem',
				...sentStyle
			};
			const titleStyle={
				'grid-column':'1/4',
				'grid-row':'1',
				'font-size':'3rem'
			};
			/*HIDDEN total minutes value; that will pass tests*/
			const hiddenTimeStyle={
				'grid-column':'1',
				'grid-row':'2',
				'font-size':'3rem',
				'text-align':'center'
			};
			/*VISIBILE hours & minutes [0-59] value;*/
			const visibleTimeStyle={
				'grid-column':'2/4',
				'grid-row':'2',
				'font-size':'3rem',
				'text-align':'center'
			};
			
			const dateStyle={
				'grid-column':'4',
				'grid-row':'2',
				'text-align':'center'
			};
			
			const buttonStyle={
				'font-size':'1rem',
				padding:'0.5rem 0.8rem',
				'cursor':'pointer'
			};

			const playPauseStyle={
				'grid-column':'1/3'
			};

			const resetStyle={
				'grid-column':'3'
			};

			return <div style={style}>
				<div id={titleId} style={titleStyle}>{mode}</div>
				
				<div id={timeId} style={hiddenTimeStyle}>
					{`${totalMinutes}:00`}
				</div>
				
				<div style={visibleTimeStyle}>
					{`${hh}:${mm}:${ss}`}
				</div>
				
				<div style={dateStyle}>
					{`${date}`}
				</div>
				
				
				
				<Button onClick={onPlayPause} sentStyle={{...buttonStyle,...playPauseStyle}} className={paused ? "fa-solid fa-pause" : "fa-solid fa-play"} />
				{/*<button style={buttonStyle} className=></button>*/}
				
				<Button id={resetId} sentStyle={{...buttonStyle,...resetStyle}} className="fa-solid fa-rotate-left"/>

			</div>;
		};

		//----------------------- component App WITHOUT LOCAL STATE ----------------------//
		class App extends React.Component{
			constructor(props){
				super(props);
			}

			render(){
				const style= {
					'display':'grid',
					'grid-template-columns':'0.5fr 0.5fr',
					'grid-template-rows':'0.5fr 1fr 1fr 0.5fr',
					/**/
					'align-items':'center',
					'justify-items':'center',
					/**/
					'background-color': 'wheat',
					'min-height': '100vh',
				};
				const headerFooterStyle={
					'font-weight':'bold',
					'grid-column':'1/3'
				};
				const timerStyle={
					'grid-column':'1/3',
					'grid-row':'3'
				};
				const props=this.props;
				
				const {breakState,workState,timerState}=props;
				const {'date-obj':dateobj}=timerState;
				
				/* break state */
				const breakObject={
					onChange:		event=>{
										props['do-break-range-onchange-minutes-event'](event),
										props['do-set-obj-event'](event)
									},
					...breakState
				};
				
				/* work state */
				const workObject={
					onChange:		event=>{
										props['do-work-range-onchange-minutes-event'](event),
										props['do-set-obj-event'](event)
									},
					...workState
				};

				const breakSliderStyle={
				
				};
				const workSliderStyle={
				
				};
				
				return (
				<div style={style}>
					
					<h1 style={headerFooterStyle}>React Redux Break/Work Timer</h1>
					
					<SessionLength text="Break Length" plusId="break-increment" minusId="session-increment" innerId="break-label" slider={breakObject} timeValueId="break-length" sentStyle={breakSliderStyle} formatTotalMinutes={formatTotalMinutes}/>
					
					<SessionLength text="Session Length" plusId="break-decrement" minusId="session-decrement" innerId="session-label" slider={workObject} timeValueId="session-length" sentStyle={workSliderStyle} formatTotalMinutes={formatTotalMinutes}/>
					
					<Timer date={timerState['date-obj']} totalMinutes={workObject.minutes} convertTotalMinutes={convertTotalMinutes} onPlayPause={e=>props['do-set-setTimeoutId'](props['do-set-obj-decrement'],1000)}  paused={timerState['paused']} sentStyle={timerStyle} startPauseId="start_stop" resetId="reset" titleId="timer-label" timeId="session-length"/>
					
					<footer style={headerFooterStyle}><p>by Abdullah Fatota</p></footer>
				</div>);
			}
			componentDidMount(){
				const props=this.props;
				props['do-break-range-set-minutes-once'](props.breakState.defaultMinutes);
				props['do-work-range-set-minutes-once'](props.workState.defaultMinutes);
			}
		}
		//----------------------- APP2 component ----------------------//
		const App2= connect(mapStateToProps, mapDispatchToProps)(App);
		
		//----------------------- react componentAppWrapper ----------------------//
		class AppWrapper extends React.Component{
			constructor(props){
				super(props);		
			}
			render(){
				//store prop IS REQUIRED.
				return (<Provider store={store}>
					<App2/>
				</Provider>);
			}
		}
		//----------------------- put component AppWrapper in DOM ----------------------//

		const container=document.querySelector('#react-container-1');
		ReactDOM.render(<AppWrapper/>,container);
		

	</script>

	<!-- free code camp test suite -->
	<script src="./libraries/test bundle.js"></script>

	
</body>

</html>